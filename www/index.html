from ihazmoney import data

# ========================================================================== ^L

if request.user.ANON:
    tags, transactions, summary, balance = data.dummy()
else:
    email = request.user.session['email']
    tags, transactions, summary = data.get(email)
    balance = request.user.session['balance']

# ========================================================================== ^L
<!DOCTYPE html>
<html>
    <head>
        <title>ihazmoney</title>
        <script src="/assets/jquery-1.7.1.min.js"></script>
        <script src="/assets/jquery.mousewheel.js"></script>
        <style>@import url("/assets/ihazmoney.css");</style>
        <script src="/assets/ihazmoney.js"></script>
        <script>
            $(document).ready(IHazMoney.main);
        </script>
        {% block head %}{% end %}
    </head>
    <body>
        <div id="body">

            <div id="top">
                <div id="sign">
                    {% if "signing_in" in globals() %}
                    You are signing in.
                    {% elif request.user.ANON %}       
                    You are not signed in. <a href="/sign/in.html">Sign in</a>.
                    {% else %}
                    {{ request.user.session['email'] }} -
                    <a href="/sign/out.html">sign out</a>
                    {% end %}
                </div>
                <div id="balance">${{ balance }}</div>
            </div>

            <!--
                <span class="widget"><input 
                /><button>create</button></span><span 
                class="knob">create a tag</span>
            -->

            <table>
                <thead class="pegged">
                    <tr class="heads">
                        <th colspan="4" class="corner"></th>
                        {% for tag in tags %}<th 
                            tag="{{ tag }}">{{ tag }}</th>{% end %}
                    </tr>
                    <tr class="summary">
                        <th colspan="4" class="corner"></th>
                        {% for tag in tags %}<th tag="{{ tag }}"
                            class="amount">{{ summary[tag] }}</th>{% end %}
                    </tr>
                </thead>
                <thead class="unpegged">
                    <tr class="heads">
                        <th colspan="4" class="corner"></th>
                        {% for tag in tags %}<th 
                            tag="{{ tag }}">{{ tag }}</th>{% end %}
                    </tr>
                    <tr class="summary">
                        <th colspan="4" class="corner"></th>
                        {% for tag in tags %}<th tag="{{ tag }}"
                            class="amount">{{ summary[tag] }}</th>{% end %}
                    </tr>
                </thead>
                <tbody>
                    {% for tid, amount, desc, date, tag in data.gentxns(transactions) %}
                    <tr tid="{{ tid }}" tag="{{ tag }}">
                        {{ date }}
                        <td class="description">{{ desc }}</td>
                        {% for _tag in tags %}<td 
                            class="amount{% if _tag == tag %} tagged{% end %}"
                            tag="{{ _tag }}">
                            {% if _tag == tag %}{{ amount }}{% end %}</td>
                        {% end %}
                    </tr>
                    {% end %}
                </tbody>
            </table>

        </div>{% if website.gauges %}
        <script type="text/javascript">
          var _gauges = _gauges || [];
          (function() {
            var t   = document.createElement('script');
            t.type  = 'text/javascript';
            t.async = true;
            t.id    = 'gauges-tracker';
            t.setAttribute('data-site-id', '4ee664fe613f5d7f24000001');
            t.src = '//secure.gaug.es/track.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(t, s);
          })();
        </script>{% end %}
    </body>
</html>
