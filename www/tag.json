from ihazmoney import db

TAG = """

DELETE FROM taggings 
      WHERE transaction_id = %s 
        AND (SELECT email FROM transactions WHERE id = %s) = %s;

INSERT INTO taggings (transaction_id, tag_id)
     VALUES (%s, (SELECT id FROM tags WHERE email = %s AND tag = %s))

"""

^L

if not request.user.ANON:
    email = request.user.session['email']
    tid = request.qs.one('tid')
    tag = request.qs.one('tag')
    db.execute(TAG, (tid, tid, email, tid, email, tag))
response.code = 204
